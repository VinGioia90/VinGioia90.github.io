<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SCM">
<title>An introduction to SCM: Fit an additive covariance matrix model for multivariate normal data  • SCM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to SCM: Fit an additive covariance matrix model for multivariate normal data ">
<meta property="og:description" content="SCM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SCM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/SCM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>An introduction to SCM: Fit an additive covariance matrix model for multivariate normal data </h1>
                        <h4 data-toc-skip class="author">Vincenzo Gioia and Matteo Fasiolo</h4>
            
            <h4 data-toc-skip class="date">2023-02-27</h4>
      
      
      <div class="d-none name"><code>SCM.Rmd</code></div>
    </div>

    
    
<style>
body {
text-align: justify}
</style>
<div class="section level2">
<h2 id="multivariate-gaussian-additive-models">Multivariate Gaussian additive models<a class="anchor" aria-label="anchor" href="#multivariate-gaussian-additive-models"></a>
</h2>
<p>Let <span class="math inline">\(\boldsymbol y_i\sim \mathcal{N}(\boldsymbol \mu_i, \boldsymbol \Sigma_i)\)</span>, <span class="math inline">\(i=1, \ldots, n\)</span>, be independent response vectors.</p>
<p>The covariates enter the model through the linear predictor vector <span class="math inline">\(\boldsymbol \eta_i=(\eta_{i1}, \ldots, \eta_{iq})\)</span>, with <span class="math inline">\(q= d+d(d+1)/2\)</span>, whose components allow specifying linear and smooth effects.</p>
<p>The mean model is specified by <span class="math inline">\(\mu_{ij} = \eta_{ij}\)</span>, <span class="math inline">\(j=1, \ldots,d\)</span>, while the remaining <span class="math inline">\(\eta_{ij}\)</span>, <span class="math inline">\(j=d+1, \ldots,q\)</span>, specify the nonredundant, unconstrained elements of a covariance matrix parametrisation. The latter can be stated via the modified Cholesky decomposition (MCD) by Pourahmadi (1999) or the matrix logarithmic tranformation by Chiu et al. (1996)</p>
<p>The multivariate Gaussian additive models are fitted via the <code><a href="../reference/gam_scm.html">gam_scm()</a></code> wrapper</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gam_scm.html">gam_scm</a></span><span class="op">(</span><span class="va">formula</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mvn_scm.html">mvn_scm</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fl">2</span>, param <span class="op">=</span> <span class="cn">NULL</span>, nb <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, optimizer <span class="op">=</span> <span class="cn">NULL</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, aGam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The inputs of the <code><a href="../reference/gam_scm.html">gam_scm()</a></code> function are:</p>
<ul>
<li>
<code>formula</code>: list of model formulas;</li>
<li>
<code>mvn_scm</code>: model family:
<ul>
<li>
<code>d</code>: dimension of the outcome vector;</li>
<li>
<code>param</code>: by default the MCD parametrisation (<code>"mcd"</code>), otherwise set (<code>"logm"</code>) for the logM one;</li>
<li>
<code>nb</code>: number of of blocks for chunking the evaluation of some quantities (default no chunks, while consider to increase such value if memory problem appears);</li>
</ul>
</li>
<li>
<code>data</code>: a data frame or a list containing the outcomes and the covariates;</li>
<li>
<code>optimizer</code>: optional argument specifying the approach to smoothing parameter optimisation; by default the generalised Fellner-Schall method (<code>"efs"</code>) by Wood and Fasiolo (2017), otherwise <em>only for the MCD parametrisation</em> the quasi Newton’s optimisation of the Laplace approximate marginal likelihood criterion (<code>"bfgs"</code>) according to Wood et al. (2016);</li>
<li>
<code>aGam</code>: a list of auxiliary arguments that could be passed to the <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam()</a></code> function of the <strong>mgcv</strong> package (Wood, 2017).</li>
</ul>
</div>
<div class="section level2">
<h2 id="illustration">Illustration<a class="anchor" aria-label="anchor" href="#illustration"></a>
</h2>
<p>We introduce the most important functions of the package by means of the GefCom2014 dataset (Hong et al., 2016). For illustrative purposes, the hourly loads (in MW) from 5 p.m. (<code>load_h17</code>) to 8 p.m (<code>load_h20</code>) on a daily basis are considered as the outcome variables. The dataset, spanning the period from 2005/01/02 to 2011/11/30, includes the day of the year (<code>doy</code>), the day of the week (<code>dow</code>), the exponentially smoothed temperature (<code>temp95_h&lt;k&gt;</code>) and the loads of the previous day (<code>load24_h&lt;k&gt;</code>) at the <span class="math inline">\(k\)</span>-th hour, <span class="math inline">\(k=17,\ldots, 20\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vingioia90.github.io/SCM/">SCM</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">GEF14_d4</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">4</span></span></code></pre></div>
<p>We start specifying the model formula for the mean vector:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_k</span> <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="va">my_bs</span> <span class="op">=</span> <span class="st">"cr"</span></span>
<span><span class="va">mformula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">load_h17</span> <span class="op">|</span> <span class="va">load_h18</span> <span class="op">|</span> <span class="va">load_h19</span> <span class="op">|</span> <span class="va">load_h20</span>  <span class="op">~</span> <span class="va">dow</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">doy</span>, k <span class="op">=</span> <span class="va">my_k</span>, bs <span class="op">=</span> <span class="va">my_bs</span><span class="op">)</span>,</span>
<span>                 <span class="va">load_h17</span> <span class="op">~</span> <span class="va">load24_h17</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h17</span><span class="op">)</span>,</span>
<span>                 <span class="va">load_h18</span> <span class="op">~</span> <span class="va">load24_h18</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h18</span><span class="op">)</span>,</span>
<span>                 <span class="va">load_h19</span> <span class="op">~</span> <span class="va">load24_h19</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h19</span><span class="op">)</span>,</span>
<span>                 <span class="va">load_h20</span> <span class="op">~</span> <span class="va">load24_h20</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The model formula is composed by two parts:</p>
<ul>
<li>“Common” specification: by using the <code>|</code> operator, all the outcomes of the l.h.s. of <code>y ~ x</code> involve the same covariates (first row);</li>
<li>“Single-element” specification: the (rest of the) formula involving element-specific covariates can be stated separately (last 4 rows);</li>
</ul>
<p>For simplicity, we consider the MCD-based additive covariance matrix model, which means modelling the elements of <span class="math inline">\(\log \boldsymbol D^2_i\)</span> and <span class="math inline">\(\boldsymbol T_i\)</span> resulting from <span class="math inline">\(\boldsymbol \Sigma^{-1}_i={\boldsymbol T^\top_i}{ \boldsymbol D^{-2}_i} {\boldsymbol T_i}\)</span>. For this application, it means to specify a model formula for the non-trivial elements of</p>
<p><span class="math display">\[ \log \boldsymbol D^2_i = \begin{pmatrix}\eta_{i5}  &amp; 0 &amp; 0  &amp; 0 \\ 0&amp; \eta_{i6} &amp; 0 &amp; 0 \\0  &amp; 0 &amp; \eta_{i7} &amp; 0 \\0 &amp; 0 &amp; 0 &amp; \eta_{i8}\end{pmatrix} \hspace{2cm} \boldsymbol T_i= \begin{pmatrix} 1  &amp; 0 &amp; 0 &amp; 0 \\ \eta_{i9}&amp; 1 &amp; 0 &amp; 0 \\ \eta_{i10}  &amp;  \eta_{i11} &amp; 1 &amp; 0 \\\eta_{i12} &amp; \eta_{i13} &amp; \eta_{i14} &amp;  1\end{pmatrix}\]</span></p>
<p>We facilitate the model formula specification (implicitly allowing a connection with the logM parametrisation) by introducing a matrix <span class="math inline">\(\boldsymbol \Theta_i\)</span> as in the form</p>
<p><span class="math display">\[\boldsymbol \Theta_i= \begin{pmatrix} \eta_{i4}  &amp; \eta_{i9} &amp; \eta_{i10} &amp; \eta_{i12} \\ \eta_{i9}&amp; \eta_{i5} &amp; \eta_{i11} &amp; \eta_{i13} \\ \eta_{i10}  &amp;  \eta_{i11} &amp; \eta_{i7} &amp; \eta_{i14} \\\eta_{i12} &amp; \eta_{i13} &amp; \eta_{i14} &amp;  \eta_{i8} \end{pmatrix}\]</span></p>
<p>whose relation with the matrices <span class="math inline">\(\log \boldsymbol D^2_i\)</span> and <span class="math inline">\(\boldsymbol T_i\)</span> is simply <span class="math inline">\([\boldsymbol \Theta_i]_{jj}=[\log \boldsymbol D^2_i]_{jj}\)</span>, <span class="math inline">\(j=1, \ldots, 4\)</span>, and <span class="math inline">\([\boldsymbol \Theta_i]_{jk}= [\boldsymbol \Theta_i]_{kj}= [\boldsymbol T_i]_{jk}\)</span>, <span class="math inline">\(1 \leq k &lt; j \leq 4\)</span>.</p>
<p>For instance, consider the following model formula for the covariance matrix model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_k2</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">my_bs</span> <span class="op">=</span> <span class="st">"tp"</span></span>
<span><span class="va">mformula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mformula</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> </span>
<span>                 <span class="va">Th_11</span> <span class="op">|</span> <span class="va">Th_22</span> <span class="op">|</span> <span class="va">Th_33</span> <span class="op">|</span> <span class="va">Th_44</span> <span class="op">|</span> <span class="va">Th_12</span> <span class="op">|</span> <span class="va">Th_23</span> <span class="op">|</span> <span class="va">Th_34</span>  <span class="op">~</span> <span class="va">dow</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">doy</span>, k <span class="op">=</span> <span class="va">my_k</span>, bs <span class="op">=</span> <span class="va">my_bs</span><span class="op">)</span>,</span>
<span>                 <span class="va">Th_11</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h17</span><span class="op">)</span>,</span>
<span>                 <span class="va">Th_22</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h18</span><span class="op">)</span>,</span>
<span>                 <span class="va">Th_33</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h19</span><span class="op">)</span>,</span>
<span>                 <span class="va">Th_44</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">temp95_h20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As in the mean model, the covariance matrix model can be stated using a “Common” and a “Single-element” specification. However, the l.h.s. of the model formula statement <code>y ~ x</code> targets the element of <span class="math inline">\(\boldsymbol \Theta\)</span> to be modelled via the sintax <code>Th_st ~ x</code>, where <span class="math inline">\(s\)</span> and <span class="math inline">\(t\)</span> are the indices targeting the elements of <span class="math inline">\(\boldsymbol \Theta_i\)</span>.</p>
<p>Note that not specifying a model formula for a component of <span class="math inline">\(\Theta\)</span> that implies such element is automatically modelled via intercept. In contrast, the model formula for the mean vector components requires to be specified in any case.</p>
<p>The model is then fitted via</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gam_scm.html">gam_scm</a></span><span class="op">(</span><span class="va">mformula</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mvn_scm.html">mvn_scm</a></span><span class="op">(</span>d<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">GEF14_d4</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object <code>fit1</code> is of class <code>"scm"</code> and can be explored via</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>: to obtain the plot of the smooth effects on the linear predictor scale</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit1</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, pages <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span></code></pre></div>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>: summary of linear and smooth effects (<code>intercept = FALSE</code> avoids printing the intercepts)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code>: raw residuals (<code>type = "response"</code>), uncorrelated standard normal residuals (default, <code>"deviance"</code>) and Pearson’s residuals (<code>"pearson"</code>)</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit1</span>, type <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function allows to obtain:</p>
<ul>
<li>fitted values in terms of <span class="math inline">\(\boldsymbol \eta\)</span>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>fitted values in terms of mean vector, variances and correlations (Note that the first four columns corresponds to the mean vector, the columns 5-8 the variances and the last six columns correspon to the correlations following the row-wise ordering, that is (2,1), (3,1), (3,2), (4,1), (4,2) and (4,3))</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<ul>
<li>fitted values in terms of (mean vector, variances, covariances)</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="fu">put_cflag</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="va">Sigma_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Sigma_pred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span><span class="co">## 1 115.57999 109.29417 107.12426 107.55051 345.00041 380.41531 404.21131</span></span>
<span><span class="co">## 2 103.62242  95.79812  92.15967  90.95859 194.88233 211.45315 218.47222</span></span>
<span><span class="co">## 3  90.72186  82.53147  78.76657  77.47152  75.38906  82.02693  87.68686</span></span>
<span><span class="co">## 4  91.27840  82.81718  78.84653  77.25713  82.63282  88.90992  93.91295</span></span>
<span><span class="co">## 5  90.34403  81.23424  76.69174  74.78123  74.13510  80.50152  87.18804</span></span>
<span><span class="co">## 6 101.00277  93.29391  88.97594  87.38839 146.50549 154.48771 162.74744</span></span>
<span><span class="co">##        [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]</span></span>
<span><span class="co">## 1 430.83223 361.22653 370.78073 391.54811 380.85143 402.90381 416.52786</span></span>
<span><span class="co">## 2 224.53788 202.14192 204.03489 214.30886 205.08170 216.00432 220.79684</span></span>
<span><span class="co">## 3  93.52467  78.10238  79.82161  84.38060  81.34185  86.35829  90.14268</span></span>
<span><span class="co">## 4  98.78637  85.00924  86.13507  90.80895  86.98921  92.20045  95.88335</span></span>
<span><span class="co">## 5  94.53048  76.63749  78.63748  83.23227  80.58371  85.71751  90.29103</span></span>
<span><span class="co">## 6 172.51746 149.85170 152.78919 158.12093 155.89525 161.74611 166.90203</span></span></code></pre>
<p>The function <code><a href="../reference/Sigma_mat.html">Sigma_mat()</a></code> allows to organise the covariance matrices in a list, for instance</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Sigma_mat.html">Sigma_mat</a></span><span class="op">(</span><span class="va">Sigma_pred</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">d</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##          [,1]     [,2]     [,3]     [,4]</span></span>
<span><span class="co">## [1,] 345.0004 361.2265 370.7807 380.8514</span></span>
<span><span class="co">## [2,] 361.2265 380.4153 391.5481 402.9038</span></span>
<span><span class="co">## [3,] 370.7807 391.5481 404.2113 416.5279</span></span>
<span><span class="co">## [4,] 380.8514 402.9038 416.5279 430.8322</span></span></code></pre>
<p>The <strong>mgcViz</strong> package by Fasiolo et al. (2020) allows to obtain the residual diagnostics and the accumulated local effects (ALEs) by Apley and Zhu (2020). For instance, the centered ALE of the variable `doy’ on the variance of the net-demand at 5 p.m. is obtained via</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mfasiolo/mgcViz" class="external-link">mgcViz</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'nlme' was built under R version 4.1.3</span></span></code></pre>
<pre><code><span><span class="co">## Warning: package 'ggplot2' was built under R version 4.1.3</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sigma_el</span> <span class="op">&lt;-</span> <span class="fu">SCM</span><span class="fu">:::</span><span class="fu">sel_elem</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="va">var_y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcViz/man/ALE.html" class="external-link">ALE</a></span><span class="op">(</span><span class="va">fit1</span>, x <span class="op">=</span> <span class="st">"doy"</span>, type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>                      oind <span class="op">=</span> <span class="fu">Sigma_el</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, center <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var_y1</span><span class="op">)</span></span></code></pre></div>
<p><img src="SCM_files/figure-html/ALEs-1.png" width="700" style="display:block; margin: auto"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Apley, D. W. and Zhu, J. (2020) Visualizing the effects of predictor variables in black box supervised learning models. Journal of the Royal Statistical Society: Series B (Statistical Methodology), 82 (4), 1059 – 1086.</p></li>
<li><p>Chiu, T. Y. M., Leonard, T. and Tsui, K.-W. (1996) The matrix-logarithmic covariance model. Journal of the American Statistical Association, 91 (433), 198 – 210.</p></li>
<li><p>Fasiolo, M., Nedellec, R., Goude, Y. and Wood, S.N., 2020. Scalable visualization methods for modern generalized additive models. Journal of computational and Graphical Statistics, 29 (1), 78–86.</p></li>
<li><p>Hong, T., Pinson, P., Fan, S., Zareipour, H., Troccoli, A., and Hyndman, R.J. (2016). Probabilistic energy forecasting: global energy forecasting competition 2014 and beyond. International Journal of Forecasting, 32, 896 – 913.</p></li>
<li><p>Pourahmadi, M. (1999) Joint mean-covariance models with applications to longitudinal data: unconstrained parameterisation. Biometrika, 86 (3), 677 – 690.</p></li>
<li><p>Wood, S. N., Pya, N. and S"{a}fken, B. (2016) Smoothing parameter and model selection for general smooth models (with discussion). Journal of the American Statistical Association, 111 (516), 1548 – 1575.</p></li>
<li><p>Wood, S. N. (2017) Generalized Additive Models: An Introduction with R, 2nd ed. Boca Raton, FL, USA: Chapman and Hall/CRC.</p></li>
<li><p>Wood, S. N. and Fasiolo, M. (2017). A generalized Fellner-Schall method for smoothing parameter optimization with application to Tweedie location, scale and shape models. Biometrics, 73 (4), 1071 – 1081.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincenzo Gioia.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
